---
title: "Reporte"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
params: 
  output_dir: "../reports"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Detalles de la simulación

```{r}

scenario<-paste0("sim_res/chain",i,model,type,nres,".Rdata")
print(scenario)
load(scenario)
print(unlist(labels))
print(total_time)
print(burn)

```

## Plots

### Betas

```{r plot1}
betas <- chain$chain_result$chain_beta[-(1:burn),]
#colnames(betas) <- paste0('Beta',0:(dim(betas)[2]-1))
betas <- data.frame(betas) %>% mutate(Index=1:n())
betas_plot <- betas %>% pivot_longer(-Index,names_to = 'Variable',values_to='Betas')
grafico_betas <- ggplot(data = betas_plot,mapping = aes(x = Index,y = Betas))+
  geom_line()+facet_wrap(vars(Variable),nrow = dim(betas)[2],scales = 'free')+
  theme_bw()
grafico_betas
colMeans(betas)
```
### Phis

```{r plot2}
Phis <- chain$chain_result$chain_Phi[-(1:burn),]
#colnames(Phis) <- paste0('Phi',0:(dim(Phis)[2]-1))
Phis <- data.frame(Phis) %>% mutate(Index=1:n())
Phis_plot <- Phis %>% pivot_longer(-Index,names_to = 'Variable',values_to='Phi')
grafico_Phis <- ggplot(data = Phis_plot,mapping = aes(x = Index,y = Phi))+
  geom_line()+facet_wrap(vars(Variable),nrow = dim(Phis)[2],scales = 'free')+
  theme_bw()
grafico_Phis
colMeans(Phis)
```
### tau


```{r plot4}
taus <- chain$chain_result$chain_tau[-(1:burn)]
taus <- data.frame(Tau=taus) %>% mutate(Index=1:n())
grafico_tau <- ggplot(data = taus,mapping = aes(x = Index,y = Tau))+
  geom_line()+
  theme_bw()
grafico_tau
colMeans(taus)
```

### Y

Porcentaje de Y observado que cae dentro del intervalo de predicción con 95%.

```{r plot6}
load(paste0("sim_data/dataset",i,type,nres,".Rdata"))
Yobs<-hh$Y
Ysample <- chain$Ysample[,-(1:burn)]
alpha<-0.05
quantileY<-t(apply(Ysample,MARGIN=1,quantile,probs=c(alpha/2,1-alpha/2)))

Y.in.interval<-map_dbl(1:length(Yobs),
    ~{between(Ysample[.],quantileY[.,1],quantileY[.,2])})
mean(Y.in.interval)

```
